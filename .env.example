# MeshCentral Stack Environment Variables
# Copy this file to .env and update with your actual values
# DO NOT commit .env to version control

# ===========================================
# MeshCentral Configuration
# ===========================================
# Your domain name (required)
MESHCENTRAL_HOSTNAME=mesh.example.com
MESHCENTRAL_SITE='MeshCentral'

# Node environment
NODE_ENV=production

# Reverse proxy settings
REVERSE_PROXY=caddy
REVERSE_PROXY_TLS_PORT=443

# ===========================================
# MongoDB Configuration
# ===========================================
# MongoDB root credentials (used for admin tasks)
MONGO_ROOT_USERNAME=admin
MONGO_ROOT_PASSWORD=changeme_secure_root_password_here

# MongoDB database name
MONGO_DATABASE=meshcentral

# MeshCentral database user credentials
MESHCENTRAL_DB_USER=meshcentral
MESHCENTRAL_DB_PASSWORD=changeme_secure_db_password_here

# ===========================================
# Caddy Configuration
# ===========================================
# Email for Let's Encrypt certificates
ACME_EMAIL=admin@example.com

# Caddy port configuration (default: 80, 443)
CADDY_HTTP_PORT=80
CADDY_HTTPS_PORT=443
CADDY_ADMIN_PORT=2019

# Cloudflare API for DNS challenge
CLOUDFLARE_API_TOKEN=your_cloudflare_dns_api_token_here

# ===========================================
# Cloudflare Tunnel Configuration (Optional)
# ===========================================
# Only needed if using Cloudflare Tunnel
# Get your tunnel token from: https://one.dash.cloudflare.com/
CLOUDFLARE_TUNNEL_TOKEN=your_cloudflare_tunnel_token_here

# ===========================================
# CrowdSec Configuration (Optional)
# ===========================================
# CrowdSec container name (used by init script)
CROWDSEC_CONTAINER=meshcentral-crowdsec

# CrowdSec Local API URL (internal Docker network)
CROWDSEC_LAPI_URL=http://crowdsec:8080

# Name for the MeshCentral bouncer
CROWDSEC_BOUNCER_NAME=meshcentral

# ===========================================
# Traefik Reverse Proxy Configuration (Optional - profile: traefik)
# ===========================================
# HTTP and HTTPS ports exposed by the Traefik container (default: 80 and 443)
# NOTE: Do not run Traefik and WAF simultaneously on the same ports.
TRAEFIK_HTTP_PORT=80
TRAEFIK_HTTPS_PORT=443

# Internal port for Traefik health-check (/ping) and Prometheus metrics (/metrics).
# Only reachable inside the Docker network – do not expose publicly.
TRAEFIK_INTERNAL_PORT=8082

# Hostname for the Traefik dashboard.
# Configure a second public hostname in the Cloudflare Tunnel pointing to
# https://traefik:443; Traefik routes it to the dashboard via this Host rule.
# Protect it with a Cloudflare Access policy (recommended).
TRAEFIK_DASHBOARD_HOSTNAME=traefik.example.com

# CrowdSec bouncer API key for the Traefik plugin.
# Leave empty initially. There are two ways to populate it:
#   1. Automated: run the crowdsec-init profile – it generates the key and injects
#      it into traefik/dynamic/middlewares.yml automatically.
#   2. Manual: generate via `docker exec meshcentral-crowdsec cscli bouncers add
#      meshcentral-traefik -o raw`, then set the key here and re-run render-config.sh.
# render-config.sh uses this value to render traefik/dynamic/middlewares.yml.
# After setting the key, restart Traefik to apply:
#   docker compose --profile traefik restart traefik
TRAEFIK_CROWDSEC_BOUNCER_KEY=

# ===========================================
# WAF (nginx + ModSecurity + OWASP CRS) Configuration
# ===========================================
# HTTP and HTTPS ports exposed by the WAF container (default: 80 and 443)
WAF_HTTP_PORT=80
WAF_HTTPS_PORT=443

# The WAF is configured via waf/nginx.conf and waf/modsecurity.conf which are
# copied into the custom Docker image at build time (waf/Dockerfile).
# Edit those files directly and rebuild: docker compose build waf
#
# To change the ModSecurity engine mode without rebuilding, edit
# waf/modsecurity.conf and restart: docker compose restart waf

# ===========================================
# Monitoring (Prometheus + Grafana) Configuration (Optional - profile: monitoring)
# ===========================================
# Hostname for the Grafana dashboard.
# Configure a public hostname in the Cloudflare Tunnel pointing to
# https://traefik:443; Traefik routes it here via the Host rule.
# Protect with a Cloudflare Access policy (recommended).
GRAFANA_HOSTNAME=grafana.example.com

# Grafana admin credentials
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=changeme_secure_grafana_password_here

# ===========================================
# Security Notes
# ===========================================
# 1. Generate strong passwords using: openssl rand -base64 32
# 2. Never use default passwords in production
# 3. Keep this file secure with proper file permissions: chmod 600 .env
# 4. Add .env to .gitignore to prevent accidental commits
# 5. Regularly rotate credentials
# 6. Use different passwords for each service
# 7. Consider using Docker secrets or a secrets manager for production
